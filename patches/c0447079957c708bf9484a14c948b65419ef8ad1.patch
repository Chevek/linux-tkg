From c0447079957c708bf9484a14c948b65419ef8ad1 Mon Sep 17 00:00:00 2001
From: Nanotwerp <Nanotwerp@gmail.com>
Date: Fri, 10 Nov 2023 19:50:04 -0500
Subject: [PATCH] Update 0013-fedora-rpm.patch to fix kernel-install issue on
 Fedora

Patch grabbed from https://lore.kernel.org/linux-kbuild/20231103-rpmpost-v1-1-9c18afab47f4@meta.com/
---
 linux-tkg-patches/6.6/0013-fedora-rpm.patch | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/linux-tkg-patches/6.6/0013-fedora-rpm.patch b/linux-tkg-patches/6.6/0013-fedora-rpm.patch
index 266b655c..babc70dc 100644
--- a/linux-tkg-patches/6.6/0013-fedora-rpm.patch
+++ b/linux-tkg-patches/6.6/0013-fedora-rpm.patch
@@ -1,5 +1,5 @@
 diff --git a/scripts/package/kernel.spec b/scripts/package/kernel.spec
-index 3eee0143e0c5..ece7078c0741 100644
+index 3eee0143e0c5..552177c1dfc5 100644
 --- a/scripts/package/kernel.spec
 +++ b/scripts/package/kernel.spec
 @@ -27,8 +27,8 @@ The Linux Kernel, the operating system core itself
@@ -44,4 +44,15 @@ index 3eee0143e0c5..ece7078c0741 100644
  %prep
  %setup -q -n linux
  cp %{SOURCE1} .config
+@@ -77,10 +96,7 @@ rm -rf %{buildroot}
+ 
+ %post
+ if [ -x /sbin/installkernel -a -r /boot/vmlinuz-%{KERNELRELEASE} -a -r /boot/System.map-%{KERNELRELEASE} ]; then
+-cp /boot/vmlinuz-%{KERNELRELEASE} /boot/.vmlinuz-%{KERNELRELEASE}-rpm
+-cp /boot/System.map-%{KERNELRELEASE} /boot/.System.map-%{KERNELRELEASE}-rpm
+-rm -f /boot/vmlinuz-%{KERNELRELEASE} /boot/System.map-%{KERNELRELEASE}
+-/sbin/installkernel %{KERNELRELEASE} /boot/.vmlinuz-%{KERNELRELEASE}-rpm /boot/.System.map-%{KERNELRELEASE}-rpm
++/sbin/installkernel %{KERNELRELEASE} /boot/vmlinuz-%{KERNELRELEASE} /boot/System.map-%{KERNELRELEASE}
+ rm -f /boot/.vmlinuz-%{KERNELRELEASE}-rpm /boot/.System.map-%{KERNELRELEASE}-rpm
+ fi
  
